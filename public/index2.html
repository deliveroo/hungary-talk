<!DOCTYPE html>
<html>
<head>
    <title>Speech-Based Food Search</title>
</head>
<body>
<h1>Speech-Based Food Search </h1>
<p>Click the "Search Food" button to search your food:</p>
<button id="record-button">Search Food</button>
<button id="stop-button" disabled>Stop</button>

<script>
    // Initialize audio recorder
    let audioRecorder;
    let recordedChunks = [];

    // Create audio stream and recorder when "Record" button is clicked
    document.getElementById("record-button").addEventListener("click", async () => {
        // Disable "Record" button
        document.getElementById("record-button").disabled = true;

        // Enable "Stop" button
        document.getElementById("stop-button").disabled = false;

        // Create audio stream and recorder
        const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
        audioRecorder = new MediaRecorder(stream);

        // Start recording audio
        audioRecorder.start();

        // Add audio chunks to array as they are recorded
        audioRecorder.addEventListener("dataavailable", (event) => {
            recordedChunks.push(event.data);
        });
    });

    // Stop audio recorder and enable "Save" button when "Stop" button is clicked
    document.getElementById("stop-button").addEventListener("click", () => {
        // Disable "Stop" button
        document.getElementById("stop-button").disabled = true;

        // Stop audio recorder
        audioRecorder.stop();
        // Wait for 0.5 seconds
        setTimeout(async () => {
            // Create Blob from recorded audio chunks
            const blob = new Blob(recordedChunks, {type: "audio/webm"});

            // Send the blob to the Go server
            const formData = new FormData();
            formData.append("audio", blob);

            await fetch("http://localhost:8090/upload-audio", {
                method: "POST",
                body: formData,
            });

            // Reset recordedChunks array
            recordedChunks = [];

            // Enable "Record" button
            document.getElementById("record-button").disabled = false;
        }, 500);

    });
</script>
</body>
</html>
